<?php
function getKey($cyphertext)
{
	
	$plaintext = json_encode(array("showpassword"=>"no","bgcolor"=>"#ffffff"));
	$text = base64_decode($cyphertext);
	$key = '';
	// Iterate through each character
    for($i=0;$i<strlen($text);$i++) 
    {
    	$key .= $text[$i] ^ $plaintext[$i % strlen($plaintext)];
    }
    $newkey = $key[0];
    // Get the first repitition of the key so we can make it the proper length during encoding
    for($i = 1;$i<strlen($key);$i++)
    {
    	if($key[$i] == $newkey[0] && $key[$i+1] == $newkey[1])
    	{
    		return $newkey;
    	}
    	else
    	{
    		$newkey .= $key[$i];
    	}
    }
    return $key;
}

function getNewCookie($key)
{
	$key = substr($key, 0,4);
	$text = json_encode(array("showpassword"=>"yes", "bgcolor"=>"#ffffff"));
	
	// Make the key the correct length for this specific plaintext
	while(strlen($key)<strlen($text))
	{
		$key.=$key;
	}
	$cookie = '';
	// Iterate through each character
    for($i=0;$i<strlen($text);$i++) 
    {
    	$cookie .= $text[$i] ^ $key[$i % strlen($key)];
    }
    $cookie = base64_encode($cookie);
    return $cookie;
		
}

$key = getKey("ClVLIh4ASCsCBE8lAxMacFMZV2hdVVotEhhUJQNVAmhSEV4sFxFeaAw%3D");
print "Key: $key\n";
$cookie = getNewCookie($key);
print "New Cookie: $cookie\n";
?>
